<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BROTHERHOOD - 탈중앙화 기여기반 블록체인 사회시스템</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="additional.css">
    <link rel="stylesheet" href="input-fix.css">
  
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <meta name="theme-color" content="#000000">
    
    <!-- 헤더 -->
    <header class="header">
        <div class="container">
            <div class="mobile-header-content">
                <!-- 대시보드 탭 헤더 -->
                <div class="mobile-header-tab active" id="mobile-header-dashboard">
                    <div class="mobile-header-dashboard">
                        <div class="mobile-dashboard-title">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>대시보드</span>
                        </div>
                    </div>
                </div>

                <!-- 지갑 탭 헤더 -->
                <div class="mobile-header-tab" id="mobile-header-wallet">
                    <div class="mobile-header-wallet">
                        <div class="mobile-wallet-title">
                            <i class="fas fa-wallet"></i>
                            <span>내 지갑</span>
                        </div>
                        <div class="mobile-wallet-actions">
                            <!-- 새로고침 버튼 제거됨 -->
                        </div>
                    </div>
                </div>

                <!-- DAO 탭 헤더 -->
                <div class="mobile-header-tab" id="mobile-header-dao">
                    <div class="mobile-header-dao">
                        <div class="mobile-dao-title">
                            <i class="fas fa-users"></i>
                            <span>DAO</span>
                        </div>
                    </div>
                </div>

                <!-- 거버넌스 탭 헤더 -->
                <div class="mobile-header-tab" id="mobile-header-governance">
                    <div class="mobile-header-governance">
                        <div class="mobile-governance-title">
                            <i class="fas fa-university"></i>
                            <span>거버넌스</span>
                        </div>
                    </div>
                </div>

                <!-- 시스템 탭 헤더 -->
                <div class="mobile-header-tab" id="mobile-header-system">
                    <div class="mobile-header-system">
                        <div class="mobile-system-title">
                            <i class="fas fa-code"></i>
                            <span>시스템</span>
                        </div>
                    </div>
                </div>




            </div>
        </div>
    </header>



    <!-- 메인 컨테이너 -->
    <div class="main-container">
        <div class="container">
            <!-- 네비게이션 -->
            <nav class="nav-tabs">
                <button class="tab-btn active" data-tab="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>대시보드</span>
                    <div class="tab-notification-badge" id="dashboardNotificationBadge" style="display: none;"></div>
                </button>
                <button class="tab-btn" data-tab="wallet">
                    <i class="fas fa-wallet"></i>
                    <span>지갑</span>
                    <div class="tab-notification-badge" id="walletNotificationBadge" style="display: none;"></div>
                </button>
                <button class="tab-btn" data-tab="dao">
                    <i class="fas fa-users"></i>
                    <span>DAO</span>
                </button>
                <button class="tab-btn" data-tab="governance" onclick="window.dapp.checkGovernanceAccess()">
                    <i class="fas fa-university"></i>
                    <span>거버넌스</span>
                </button>
                <button class="tab-btn" data-tab="system">
                    <i class="fas fa-code"></i>
                    <span>시스템</span>
                </button>

            </nav>

            <!-- 대시보드 탭 -->
            <div id="dashboard" class="tab-content active">


                <div class="dashboard-grid">
                    <!-- 개인 상태 카드 -->
                    <div class="status-card" data-card="profile">
                        <div class="card-header">
                            <h3><i class="fas fa-user-circle"></i> 내 프로필</h3>
                            <div class="profile-connection-status" id="profileConnectionStatus">🟡 연결 중...</div>
                        </div>
                        <div class="card-content">
                            <div class="profile-section">
                                <!-- 프로필 사진과 기본 정보를 같은 행에 배치 -->
                                <div class="profile-header">
                                <div class="profile-photo-section">
                                    <div class="profile-photo-container">
                                            <div class="profile-photo" id="profilePhoto" onclick="window.dapp.showUserProfile(window.dapp.currentUser?.did)" title="내 프로필 보기 (클릭)">
                                            <i class="fas fa-user"></i>
                                        </div>
                                    </div>
                                </div>
                                <div class="personal-info">
                                    <div class="info-row">
                                        <label>아이디</label>
                                        <span id="userId" style="font-weight: 600;">미설정</span>
                                    </div>
                                    <div class="info-row">
                                        <label>이름</label>
                                        <span id="userName">미설정</span>
                                    </div>
                                    </div>
                                </div>

                                <!-- 프로필 카드 하단 버튼들 -->
                                <div class="profile-buttons">
                                    <button class="profile-btn contribute-btn" onclick="window.dapp.goToDAOTab()">
                                        <i class="fas fa-plus"></i>
                                        기여하기
                                    </button>
                                    <button class="profile-btn logout-btn">
                                        <i class="fas fa-sign-out-alt"></i>
                                        로그아웃
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 토큰 보유량 카드 -->
                    <div class="balance-card" data-card="balance">
                        <div class="card-header">
                            <h3><i class="fas fa-coins"></i> 토큰 보유량</h3>
                        </div>
                        <div class="card-content">
                            <div class="balance-section">
                                <div class="balance-grid">
                                    <div class="balance-item">
                                        <div class="balance-label">B-Token</div>
                                        <div class="balance-value" id="bTokenBalance">0 B</div>
                                        <!-- 기여 관련 메시지 제거됨 -->
                                        <button class="token-action-btn transfer-btn" onclick="window.dapp.goToTokenTransfer()" id="bTokenTransferButton" style="display: none;">
                                            <i class="fas fa-paper-plane"></i>
                                            전송하기
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                    </div>


                    <!-- 나의 DAO 카드 제거됨 - 토큰 보유량 카드에 통합 -->



                    <!-- BROTHERHOOD 카드 -->
                    <div class="protocol-overview-card" data-card="protocol">
                        <div class="card-header">
                            <h3><i class="fas fa-users"></i> BROTHERHOOD</h3>
                        </div>
                        <div class="card-content">
                            <div class="protocol-info">
                                <p class="protocol-description">
                                    프로토콜의 비전과 철학을 만나보세요.
                                </p>
                                <button class="btn-primary protocol-overview-btn" onclick="window.location.href='/intro.html'">
                                    <i class="fas fa-info-circle"></i> BROTHERHOOD 개요
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 검증자 참여 카드 -->
                    <div class="validator-card" data-card="validator">
                        <div class="card-header">
                            <h3><i class="fas fa-shield-alt"></i> 네트워크 검증자</h3>
                        </div>
                        <div class="card-content">
                            <div class="validator-info">
                                <p class="validator-description">
                                    네트워크 검증에 참여하여 보상을 받아보세요.
                                </p>
                                <div class="validator-stats">
                                    <div class="stat-item">
                                        <span class="stat-label">검증자 수수료 풀</span>
                                        <span class="stat-value" id="validatorPoolMain">- B</span>
                                    </div>
                                                            <div class="stat-item">
                            <span class="stat-label">블록생성 인센티브</span>
                            <span class="stat-value">0.25B</span>
                        </div>
                                </div>
                                <div class="validator-actions">
                                    <button class="btn-support validator-sponsor-btn" onclick="window.dapp.showValidatorSponsorModal()">
                                        <i class="fas fa-heart"></i> 후원하기
                                    </button>
                                    <button class="btn-primary validator-join-btn" onclick="window.dapp.navigateToValidatorDAO()">
                                        <i class="fas fa-users"></i> 참여하기
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 거버넌스 카드 -->
                    <div class="protocol-overview-card" data-card="governance">
                        <div class="card-header">
                            <h3><i class="fas fa-university"></i> 거버넌스</h3>
                        </div>
                        <div class="card-content">
                            <div class="protocol-info">
                                <p class="protocol-description">
                                    거버넌스에 참여하고 제안을 만들어보세요.
                                </p>
                                <button class="btn-primary protocol-overview-btn" onclick="window.dapp.switchTab('governance')">
                                    <i class="fas fa-balance-scale"></i> 거버넌스 참여하기
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 시스템 카드 -->
                    <div class="protocol-overview-card" data-card="system">
                        <div class="card-header">
                            <h3><i class="fas fa-code"></i> 시스템</h3>
                            </div>
                        <div class="card-content">
                            <div class="protocol-info">
                                <p class="protocol-description">
                                    프로토콜의 시스템 구조와 코드를 살펴보세요.
                                </p>
                                <button class="btn-primary protocol-overview-btn" onclick="window.dapp.switchTab('system')">
                                    <i class="fas fa-folder-tree"></i> 시스템 구조 보기
                                </button>
                        </div>
                    </div>
                    </div>


                </div>
            </div>

            <!-- 지갑 탭 -->
            <div id="wallet" class="tab-content">
                <div class="wallet-container">
                    <div class="wallet-header">
                        <h2><i class="fas fa-wallet"></i> 내 지갑</h2>
                        <div class="wallet-actions">
                            <!-- 새로고침 버튼 제거됨 -->
                        </div>
                    </div>

                    <!-- 아이디 생성/로그인 섹션 -->
                    <div class="biometric-section" id="biometricSection">
                        <div class="biometric-card">
                            <div class="card-header">
                                <h3><i class="fas fa-user-circle"></i> 아이디 생성/로그인</h3>
                            </div>
                            <div class="card-content">
                                <p class="description">BROTHERHOOD 참여를 위해 아이디를 생성하거나 로그인하세요.</p>
                                <div class="biometric-options">
                                    <button class="biometric-btn" onclick="startUserAuth()">
                                        <i class="fas fa-user-plus"></i>
                                        <span>시작하기</span>
                                    </button>
                                </div>
                                <div class="security-notice">
                                    <i class="fas fa-shield-alt"></i>
                                    <span>1기기 1계정 정책이 적용됩니다</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 지갑 정보 섹션 -->
                    <div class="wallet-info" id="walletInfo" style="display: none;">
                        <!-- 토큰 잔액 개요 -->
                        <div class="balance-overview wallet-full-width">
                            <div class="balance-card-large">
                                <div class="balance-header">
                                    <h3>B-Token</h3>
                                    <div class="balance-main" id="bTokenMain">0 B</div>
                                </div>
                                <div class="mining-info">
                                    <!-- 기여 관련 메시지 제거됨 -->
                            </div>
                            
                                <!-- 내 주소 토글 추가 -->
                                <div class="address-toggle-section">
                            <div class="address-toggle-header" onclick="window.dapp.toggleAddressCard()">
                                <div class="address-toggle-content">
                                    <i class="fas fa-address-card"></i>
                                    <span>내 주소 확인하기</span>
                                </div>
                                <i class="fas fa-chevron-down address-toggle-icon" id="addressToggleIcon"></i>
                            </div>
                            <div class="address-card-content" id="addressCardContent" style="display: none;">
                                <div class="address-section">
                                    <div class="address-info">
                                                <div class="address-label">지갑 주소</div>
                                        <div class="address-container">
                                                    <div class="address-value" id="myWalletAddress">-</div>
                                                    <div class="qr-button-group">
                                                        <button class="copy-btn" onclick="window.dapp.copyToClipboard('myWalletAddress', '지갑주소')" title="지갑주소 복사">
                                                            <i class="fas fa-copy"></i>
                                                        </button>
                
                                                    </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- QR 이미지 섹션 (버튼 없이) -->
                                <div class="qr-section">
                                    <div class="qr-container">
                                        <canvas id="qrCanvas" width="150" height="150"></canvas>
                                    </div>
                                </div>
                                
                                </div>
                            </div>
                        </div>

                        <!-- 거래 기능 -->
                        <div class="transaction-section">
                            <div class="transaction-card">
                                <div class="card-header">
                                    <h3><i class="fas fa-paper-plane"></i> 토큰 전송</h3>
                                </div>
                                <div class="card-content">
                                    <div class="transaction-fee-info">
                                        <div class="fee-notice">
                                            <i class="fas fa-info-circle"></i>
                                            <span>트랜잭션 수수료: <strong>0.1%</strong></span>
                                        </div>

                                    </div>
                                    <form id="transferForm">
                                        <div class="form-group">
                                            <label for="recipientAddress">받는 주소</label>
                                            <div class="input-with-qr">
                                                <input type="text" id="recipientAddress" placeholder="지갑 주소">
                                                <button type="button" class="qr-btn" onclick="window.qrManager.openQRScanner((result) => document.getElementById('recipientAddress').value = result)" title="QR 코드 스캔">
                                                    <i class="fas fa-camera"></i>
                                                </button>
                                            </div>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="transferAmount">전송량 (B-Token)</label>
                                            <div class="amount-input">
                                                <input type="number" id="transferAmount" placeholder="0" min="0" step="0.01">
                                                <span class="token-suffix">B</span>
                                            </div>
                                            <div class="amount-summary" id="transferSummary" style="display: none;">
                                                <div class="summary-row">
                                                    <span>전송량:</span>
                                                    <span id="transferAmountDisplay">0 B</span>
                                                </div>
                                                <div class="summary-row">
                                                    <span>수수료 (0.1%):</span>
                                                    <span id="transferFeeDisplay">0 B</span>
                                                </div>
                                                <div class="summary-row total">
                                                    <span>총 필요:</span>
                                                    <span id="totalAmountDisplay">0.001 B</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="transferMemo">메모 (선택사항)</label>
                                            <input type="text" id="transferMemo" placeholder="거래 메모">
                                        </div>
                                        <button type="submit" class="btn-primary">
                                            <i class="fas fa-paper-plane"></i> 전송
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- 거래내역 섹션 -->
                        <div class="transaction-history-section">
                            <div class="transaction-history-card">
                                <div class="card-header">
                                    <div class="card-header-left">
                                        <h3><i class="fas fa-history"></i> 거래내역</h3>
                                        <div class="transaction-notification-badge" id="transactionNotificationBadge" style="display: none;"></div>
                                    </div>
                                    <div class="card-header-right">
                                        <button class="btn-secondary btn-small" onclick="window.dapp.refreshTransactionHistory()" title="새로고침">
                                            <i class="fas fa-sync-alt"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-content">
                                    <div class="transaction-filter-tabs">
                                        <button class="transaction-filter-tab active" data-filter="all" onclick="window.dapp.filterTransactionHistory('all')">
                                            전체
                                        </button>
                                        <button class="transaction-filter-tab" data-filter="sent" onclick="window.dapp.filterTransactionHistory('sent')">
                                            보낸 거래
                                        </button>
                                        <button class="transaction-filter-tab" data-filter="received" onclick="window.dapp.filterTransactionHistory('received')">
                                            받은 거래
                                        </button>
                                    </div>
                                    <div class="transaction-list" id="transactionList">
                                        <div class="empty-state">
                                            <i class="fas fa-history"></i>
                                            <p>거래내역이 없습니다</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- DAO 탭 -->
            <div id="dao" class="tab-content">
                <div class="dao-container">
                    <div class="dao-header">
                        <h2><i class="fas fa-users"></i> DAO 컨소시엄</h2>
                    </div>

                    <div class="dao-grid" id="daoGrid">
                        <!-- DAO 카드들이 동적으로 생성됩니다 -->
                    </div>
                </div>
            </div>





    <!-- 이모지 피커 모달 -->
    <div id="emojiPickerModal" class="modal">
        <div class="modal-content emoji-picker-content">
            <div class="modal-header">
                <h3><i class="fas fa-smile"></i> 이모지</h3>
                <button class="modal-close" onclick="window.dapp.closeEmojiPicker()">&times;</button>

            </div>
            <div class="modal-body">
                <div class="emoji-grid" id="emojiGrid">
                    <!-- 이모지들이 동적으로 생성됩니다 -->
                </div>
            </div>
        </div>
    </div>

    <!-- DAO 상세 정보 모달 -->
    <div id="daoDetailModal" class="modal">
        <div class="modal-content dao-detail-content">
            <div class="modal-header">
                <h3 id="daoDetailTitle">DAO 상세 정보</h3>
                <button class="modal-close" onclick="window.dapp.closeDAODetailModal()">&times;</button>
            </div>
            
            <!-- DAO 상세 정보 콘텐츠 -->
            <div class="dao-detail-body">
                <div class="dao-detail-placeholder">
                    <i class="fas fa-users"></i>
                    <p>DAO 정보가 여기에 표시됩니다.</p>
                </div>
            </div>
        </div>
    </div>

    <div id="biometricModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>아이디 인증 진행 중</h3>
                <button class="modal-close" onclick="window.dapp.closeBiometricModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="biometric-progress">
                    <div class="step active" id="stepFingerprint">
                        <i class="fas fa-user-check"></i>
                        <span>아이디 확인</span>
                    </div>
                    <div class="step" id="stepComplete">
                        <i class="fas fa-check-circle"></i>
                        <span>완료</span>
                    </div>
                </div>
                <div class="progress-message" id="progressMessage">
                    아이디 인증을 시작합니다...
                </div>
            </div>
        </div>
    </div>

    <!-- OP 검토 모달 -->
    <div id="opReviewModal" class="modal op-review-modal">
        <div class="modal-content op-review-content">
            <div class="modal-header">
                <h3><i class="fas fa-shield-alt"></i> OP 검토 시스템</h3>
                <button class="modal-close" onclick="window.dapp.closeOPReviewModal()">&times;</button>
            </div>
            <div class="op-review-notice">
                <span>검토 의견은 공개되며 불성실 작성 시 탄핵사유가 될 수 있습니다.</span>
            </div>
            <div class="modal-body">
                <!-- OP 검토 탭 네비게이션 -->
                <div class="op-review-nav">
                    <button class="op-review-tab active" data-tab="my-dao" onclick="window.dapp.switchOPReviewTab('my-dao')">
                        <i class="fas fa-gavel"></i>
                        <span>내 DAO 검토</span>
                        <small>OP 권한으로 안건 결정</small>
                    </button>
                    <button class="op-review-tab" data-tab="ops" onclick="window.dapp.switchOPReviewTab('ops')">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>Ops 검토</span>
                        <small>이의신청 기간 (2일)</small>
                    </button>
                    <button class="op-review-tab" data-tab="final" onclick="window.dapp.switchOPReviewTab('final')">
                        <i class="fas fa-crown"></i>
                        <span>최종 검토</span>
                        <small>TOP-OP 전용 (OpsDAO OP만)</small>
                    </button>
                </div>

                <!-- OP 검토 콘텐츠 -->
                <div class="op-review-content-area">
                    <div id="op-review-content">
                        <!-- 각 탭의 콘텐츠가 동적으로 로드됩니다 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 거버넌스 탭 -->
    <div id="governance" class="tab-content">
        <div class="governance-container">
            <div class="governance-header">
                <h2><i class="fas fa-balance-scale"></i> 거버넌스</h2>
            </div>

            <!-- 거버넌스 서브탭 -->
            <div class="governance-nav">
                <button class="governance-tab active" data-tab="proposals" onclick="window.dapp.switchGovernanceTab('proposals')">
                    <i class="fas fa-lightbulb"></i>
                    <span>I. 제안</span>
                </button>
                <button class="governance-tab" data-tab="collaboration" onclick="window.dapp.switchGovernanceTab('collaboration')">
                    <i class="fas fa-handshake"></i>
                    <span>II. 협업</span>
                </button>
                <button class="governance-tab" data-tab="completed" onclick="window.dapp.switchGovernanceTab('completed')">
                    <i class="fas fa-check-circle"></i>
                    <span>III. 완료</span>
                </button>
            </div>

            <!-- 제안 탭 콘텐츠 -->
            <div id="governance-proposals" class="governance-tab-content active">
                <!-- 검색창 -->
                <div class="proposals-search-section">
                    <div class="search-container">
                        <input type="text" id="proposalSearchInput" placeholder="제안 제목 또는 ID로 검색..." 
                               onkeyup="window.dapp.governanceManager.searchProposals(this.value)">
                    </div>
                </div>

                <!-- 필터 메뉴 -->
                <div class="proposals-filter-menu">
                    <button class="filter-btn active" data-filter="popular" onclick="window.dapp.governanceManager.setFilter('popular')">
                        <i class="fas fa-fire"></i>
                        인기순
                    </button>
                    <button class="filter-btn" data-filter="date" onclick="window.dapp.governanceManager.toggleDateSort()">
                        <i class="fas fa-calendar"></i>
                        <span id="dateSortText">최신순</span>
                    </button>
                    <button class="filter-btn" data-filter="my" onclick="window.dapp.governanceManager.setFilter('my')">
                        <i class="fas fa-user"></i>
                        나의 제안
                    </button>
                    <button class="filter-btn" data-filter="bookmarked" onclick="window.dapp.governanceManager.setFilter('bookmarked')">
                        <i class="fas fa-star"></i>
                        관심 제안
                    </button>
                    


                </div>

                <div class="proposals-header">
                    <div class="proposals-title">
                        <h3>제안 목록</h3>
                        <p>시스템 개선 및 기능 추가를 위한 제안들을 확인하고 참여하세요.</p>
                    </div>
                    <button class="btn-primary create-proposal-btn" onclick="window.dapp.showCreateProposalModal()">
                        <i class="fas fa-plus"></i>
                        생성
                    </button>
                </div>

                <div class="proposals-list" id="proposalsList">
                    <!-- 제안 카드들이 동적으로 생성됩니다 -->
                </div>
            </div>

                         <!-- 협업 탭 콘텐츠 -->
             <div id="governance-collaboration" class="governance-tab-content">
                 <div id="collaborationContent" class="collaboration-content">
                     <!-- 협업 내용이 동적으로 생성됩니다 -->
                 </div>
             </div>

            <!-- 완료 탭 콘텐츠 -->
            <div id="governance-completed" class="governance-tab-content">
                <div class="completed-content">
                    <h3>완료된 제안</h3>
                    <p>성공적으로 완료된 제안들입니다.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 시스템 탭 -->
    <div id="system" class="tab-content">
        <div class="system-container">
            <div class="system-header">
                <h2><i class="fas fa-code"></i> 시스템 구조</h2>
                <div class="system-actions">
                    <button class="btn-primary download-btn" onclick="window.dapp.toggleDownloadMode()">
                        <i class="fas fa-download"></i> 가져오기
                    </button>
                </div>
            </div>

            <!-- 파일 트리 -->
            <div class="file-tree-container">
                <div class="select-all-controls">
                    <button class="select-all-btn" onclick="window.dapp.selectAllFiles()">전체 선택</button>
                    <button class="select-all-btn" onclick="window.dapp.deselectAllFiles()">전체 해제</button>
                    <button class="btn-primary" onclick="window.dapp.downloadSelectedFiles()">
                        <i class="fas fa-download"></i> 다운로드
                    </button>
                </div>
                <div class="file-tree" id="fileTree">
                    <!-- 파일 트리가 동적으로 생성됩니다 -->
                </div>
            </div>

            <!-- 파일 뷰어 -->
            <div class="file-viewer" id="fileViewer" style="display: none;">
                <div class="file-viewer-header">
                    <div class="file-path" id="filePath"></div>
                    <button class="close-viewer-btn" onclick="window.dapp.closeFileViewer()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="file-content" id="fileContent">
                    <!-- 파일 내용이 표시됩니다 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 거버넌스 제안 생성 모달 -->
    <div id="createGovernanceProposalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-lightbulb"></i> 새 제안 생성</h3>
                <button class="modal-close" onclick="window.dapp.closeCreateGovernanceProposalModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="createGovernanceProposalForm">
                    <!-- 기본 정보 -->
                    <div class="form-section">
                        <h4><i class="fas fa-info-circle"></i> 기본 정보</h4>
                        <div class="form-group">
                            <label for="proposalTitle">제목 <span class="char-count" id="titleCharCount">(0/50)</span></label>
                            <input type="text" id="proposalTitle" placeholder="제안의 제목을 입력하세요" maxlength="50" required
                                   oninput="window.dapp.governanceManager.updateCharCount('proposalTitle', 50)">
                        </div>
                        <div class="form-group">
                            <label for="proposalDescription">설명 <span class="char-count" id="descriptionCharCount">(0/1500)</span></label>
                            <textarea id="proposalDescription" rows="8" placeholder="제안에 대한 상세한 설명을 입력하세요" maxlength="1500" required
                                      oninput="window.dapp.governanceManager.updateCharCount('proposalDescription', 1500)"></textarea>
                        </div>
                    </div>

                    <!-- 코어구조 업로드 -->
                    <div class="form-section">
                        <h4><i class="fas fa-code"></i> 코어구조 <span class="required-indicator">*</span></h4>
                        <p class="section-description">시스템 수정에 대한 핵심 코드를 업로드하세요. <strong>(필수)</strong></p>
                        <div class="core-structure-upload">
                            <div class="upload-options">
                                <button type="button" class="upload-btn" onclick="document.getElementById('coreStructureInput').click()">
                                    <i class="fas fa-file-upload"></i>
                                    파일 선택
                                </button>
                                <button type="button" class="upload-btn" onclick="document.getElementById('folderStructureInput').click()">
                                    <i class="fas fa-folder-open"></i>
                                    폴더 선택
                                </button>
                            </div>
                            <div class="upload-area" id="uploadArea" 
                                 ondragover="window.dapp.handleDragOver(event)" 
                                 ondragenter="window.dapp.handleDragEnter(event)" 
                                 ondragleave="window.dapp.handleDragLeave(event)" 
                                 ondrop="window.dapp.handleDrop(event)">
                                <div class="upload-content">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <p>코어구조 파일/폴더를 선택하거나 드래그하세요</p>
                                    <small>지원 형식: .js, .json, .md, .txt, .css, .html (최대 총 20MB)</small>
                                </div>
                                <input type="file" id="coreStructureInput" accept=".js,.json,.md,.txt,.css,.html" multiple style="display: none;" onchange="window.dapp.handleCoreStructureUpload(this)">
                                <input type="file" id="folderStructureInput" webkitdirectory directory style="display: none;" onchange="window.dapp.handleCoreStructureUpload(this)">
                            </div>
                            <div class="uploaded-structure" id="uploadedStructure" style="display: none;">
                                <div class="structure-info">
                                    <div class="structure-header">
                                        <h5><i class="fas fa-file-code"></i> 업로드된 파일들</h5>
                                        <button type="button" class="remove-all-btn" onclick="window.dapp.removeAllCoreStructure()">
                                            <i class="fas fa-trash"></i> 모두 삭제
                                        </button>
                                    </div>
                                    <div class="structure-files" id="structureFilesList">
                                        <!-- 업로드된 파일들이 표시됩니다 -->
                                    </div>
                                    <div class="diff-preview" id="diffPreview">
                                        <!-- 차이점이 표시됩니다 -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 라벨 선택 -->
                    <div class="form-section">
                        <h4><i class="fas fa-tags"></i> 라벨</h4>
                        <div class="form-group">
                            <select id="proposalLabel">
                                <option value="">라벨을 선택하세요</option>
                                <option value="bugfix">버그수정</option>
                                <option value="feature">기능추가</option>
                                <option value="improvement">개선사항</option>
                                <option value="security">보안</option>
                                <option value="governance">거버넌스</option>
                                <option value="performance">성능</option>
                                <option value="ui">UI/UX</option>
                                <option value="documentation">문서화</option>
                                <option value="etc">기타</option>
                            </select>
                        </div>
                    </div>

                    <!-- 비용 정보 -->
                    <div class="form-section">
                        <div class="cost-info">
                            <div class="cost-notice">
                                <i class="fas fa-coins"></i>
                                <span>제안 생성 비용: <strong>5 B-Token</strong></span>
                            </div>
                            <small>생성 비용은 제안 등록을 위해 차감됩니다.</small>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn-secondary" onclick="window.dapp.closeCreateGovernanceProposalModal()">
                    <i class="fas fa-times"></i> 취소
                </button>
                <button type="submit" form="createGovernanceProposalForm" class="btn-primary" onclick="window.dapp.submitGovernanceProposal(event)">
                    <i class="fas fa-plus"></i> 생성 (5B)
                </button>
            </div>
        </div>
    </div>

    <!-- 거버넌스 제안 상세 모달 -->
    <div id="governanceProposalDetailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-file-alt"></i> 제안 상세 정보</h3>
                <button class="modal-close" onclick="window.dapp.closeGovernanceProposalDetailModal()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- 제안자 정보 -->
                <div class="proposal-detail-author">
                    <div class="author-avatar clickable-avatar" id="proposalDetailAvatar" 
                         title="사용자 정보 보기">A</div>
                    <div class="author-info">
                        <div class="author-name" id="proposalDetailAuthor">작성자</div>
                        <div class="author-date" id="proposalDetailDate">2024-01-01</div>
                    </div>
                    <div class="proposal-actions">
                        <button class="action-btn bookmark-btn" onclick="window.dapp.toggleProposalBookmark()" title="관심 제안">
                            <i class="far fa-star"></i>
                        </button>
                        <button class="action-btn report-btn" onclick="window.dapp.reportProposal()" title="신고하기">
                            <i class="fas fa-flag"></i>
                        </button>
                    </div>
                </div>

                <!-- 신고 누적 경고 -->
                <div class="report-warning" id="reportWarning" style="display: none;">
                    <div class="warning-content">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>신고가 누적된 제안입니다. 제안을 꼼꼼히 보고 투표해주세요.</span>
                    </div>
                </div>

                <!-- 제안 정보 -->
                <div class="proposal-detail-content">
                    <div class="proposal-id" id="proposalDetailId">GP-123456</div>
                    <h2 class="proposal-title" id="proposalDetailTitle">제안 제목</h2>
                    <div class="proposal-label" id="proposalDetailLabel">
                        <i class="fas fa-tag"></i> 라벨
                    </div>
                    <div class="proposal-description" id="proposalDetailDescription">
                        제안 설명...
                    </div>
                </div>

                <!-- 코어구조 섹션 -->
                <div class="proposal-detail-structure" id="proposalDetailStructure" style="display: none;">
                    <h4><i class="fas fa-code"></i> 기존시스템구조에 대한 코어구조</h4>
                    <div class="structure-files" id="detailStructureFiles">
                        <!-- 업로드된 파일들이 표시됩니다 -->
                    </div>
                    <div class="diff-preview" id="detailDiffPreview">
                        <!-- 차이점이 표시됩니다 -->
                    </div>
                </div>

                <!-- 투표 섹션 (투표 전) -->
                <div class="proposal-voting-section" id="votingSection">
                    <h4><i class="fas fa-vote-yea"></i> 투표하기</h4>
                    <p class="voting-notice">투표에 참여하면 0.1B가 차감되고 투표 현황이 활성화됩니다.</p>
                    <div class="voting-buttons">
                        <button class="vote-btn vote-agree" onclick="window.dapp.voteProposal('agree')">
                            <i class="fas fa-check"></i> 동의 (0.1B)
                        </button>
                        <button class="vote-btn vote-abstain" onclick="window.dapp.voteProposal('abstain')">
                            <i class="fas fa-minus"></i> 기권 (0.1B)
                        </button>
                        <button class="vote-btn vote-disagree" onclick="window.dapp.voteProposal('disagree')">
                            <i class="fas fa-times"></i> 비동의 (0.1B)
                        </button>
                    </div>
                </div>

                <!-- 투표 현황 섹션 (투표 후 표시) -->
                <div class="proposal-voting-status" id="votingStatusSection" style="display: none;">
                    <h4><i class="fas fa-chart-bar"></i> 투표 현황</h4>
                    <div class="voting-stats">
                        <div class="vote-bar-container">
                            <div class="vote-bar">
                                <div class="vote-segment agree" id="agreeBar" style="width: 0%">
                                    <span class="vote-percent">0%</span>
                                </div>
                                <div class="vote-segment abstain" id="abstainBar" style="width: 0%">
                                    <span class="vote-percent">0%</span>
                                </div>
                                <div class="vote-segment disagree" id="disagreeBar" style="width: 0%">
                                    <span class="vote-percent">0%</span>
                                </div>
                            </div>
                        </div>
                        <div class="vote-counts">
                            <div class="vote-count agree">
                                <i class="fas fa-check"></i>
                                <span>동의: <strong id="agreeCount">0</strong>명</span>
                            </div>
                            <div class="vote-count abstain">
                                <i class="fas fa-minus"></i>
                                <span>기권: <strong id="abstainCount">0</strong>명</span>
                            </div>
                            <div class="vote-count disagree">
                                <i class="fas fa-times"></i>
                                <span>비동의: <strong id="disagreeCount">0</strong>명</span>
                            </div>
                        </div>
                    </div>
                    <div class="user-vote-info">
                        <i class="fas fa-user-check"></i>
                        <span>내 투표: <strong id="userVote">-</strong></span>
                    </div>
                </div>


            </div>
        </div>
    </div>

    <!-- 제안하기 모달 -->
    <div id="createProposalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>새 제안 작성</h3>
                <button class="modal-close" onclick="window.dapp.closeCreateProposalModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="createProposalForm">
                    <!-- 제안 유형 선택 -->
                    <div class="form-group">
                        <label>제안 유형</label>
                        <div class="proposal-type-selector">
                            <div class="proposal-type-option">
                                <input type="radio" id="generalProposal" name="proposalType" value="general" checked onchange="window.dapp.handleProposalTypeChange()">
                                <label for="generalProposal">일반제안</label>
                            </div>
                            <div class="proposal-type-option">
                                <input type="radio" id="daoCreationProposal" name="proposalType" value="dao_creation" onchange="window.dapp.handleProposalTypeChange()">
                                <label for="daoCreationProposal">DAO생성제안</label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 일반제안 양식 -->
                    <div id="generalProposalForm" class="proposal-form-section">
                    <div class="form-group">
                        <label for="proposalDAO">대상 DAO</label>
                        <select id="proposalDAO" required onchange="window.dapp.handleDAOSelection()">
                            <option value="">DAO를 선택하세요</option>
                            <!-- 소속 DAO 목록이 동적으로 생성됩니다 -->
                        </select>
                    </div>
                    <!-- OP 탄핵안 체크박스 (DAO 선택 시 표시) -->
                    <div class="form-group" id="impeachmentOption" style="display: none;">
                        <div class="impeachment-checkbox-simple">
                                <label>
                                    <input type="checkbox" id="isImpeachmentProposal" onchange="window.dapp.handleImpeachmentToggle()">
                                    OP 탄핵안
                                </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="proposalTitle">제안 제목</label>
                        <input type="text" id="proposalTitle" placeholder="제안 제목을 입력하세요" required>
                    </div>
                    <div class="form-group">
                        <label for="proposalDescription">제안 내용</label>
                        <textarea id="proposalDescription" rows="6" placeholder="제안 내용을 상세히 작성하세요" required></textarea>
                    </div>
                        
                        <!-- 모금기간 설정 -->
                    <div class="form-group">
                            <label for="proposalFundingEndDate">모금 종료일</label>
                            <input type="date" id="proposalFundingEndDate" required>
                            <small>당일부터 14일 후까지 선택 가능합니다</small>
                        </div>
                        
                                                 <script>
                             // 모금 종료일 날짜 제한 설정 및 초기 수수료 설정
                             document.addEventListener('DOMContentLoaded', function() {
                                 const today = new Date();
                                 const maxDate = new Date(today);
                                 maxDate.setDate(today.getDate() + 14);
                                 
                                 const fundingEndDateInput = document.getElementById('proposalFundingEndDate');
                                 if (fundingEndDateInput) {
                                     fundingEndDateInput.min = today.toISOString().split('T')[0];
                                     fundingEndDateInput.max = maxDate.toISOString().split('T')[0];
                                     
                                     // 기본값을 7일 후로 설정
                                     const defaultDate = new Date(today);
                                     defaultDate.setDate(today.getDate() + 7);
                                     fundingEndDateInput.value = defaultDate.toISOString().split('T')[0];
                                 }
                                 
                                 // 초기 수수료 표시 (50B의 1% = 0.5B)
                                 const feeDisplay = document.getElementById('proposalFeeAmount');
                                 if (feeDisplay) {
                                     feeDisplay.textContent = '0.50 B (1%)';
                                 }
                             });
                         </script>
                        
                        <div class="form-group">
                            <label for="proposalStake">제안자 모금액 B-Token</label>
                            <input type="number" id="proposalStake" min="50" step="0.1" placeholder="최소 50B" required oninput="window.dapp.updateProposalFee()">
                            <small>제안을 위해 최소 50B 이상의 모금액을 설정해야 합니다</small>
                    </div>
                    <!-- 첨부파일 섹션 -->
                    <div class="form-group">
                        <label for="proposalAttachments">첨부파일</label>
                        <div class="file-upload-area" onclick="document.getElementById('proposalFileInput').click()">
                            <div class="file-upload-content">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p>클릭하여 파일을 선택하거나 드래그하여 업로드하세요</p>
                                <small>지원 형식: PDF, DOC, DOCX, TXT, JPG, PNG (최대 10MB)</small>
                            </div>
                            <input type="file" id="proposalFileInput" multiple accept=".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png" style="display: none;" onchange="window.dapp.handleProposalFileUpload(this)">
                        </div>
                        <div class="uploaded-files-list" id="proposalUploadedFiles"></div>
                    </div>
                    <div class="proposal-fee-info">
                        <div class="fee-notice">
                            <i class="fas fa-info-circle"></i>
                                <span>제안 수수료: <strong id="proposalFeeAmount">0.50 B (1%)</strong></span>
                        </div>

                    </div>
                    <div class="proposal-requirements">
                        <h4 id="requirementsTitle">제안 요구사항</h4>
                        <ul id="requirementsList">
                                <li>모금된 금액은 투표통과시 실행과정에 쓰이며, 남은 금액은 시스템에 분배됩니다.</li>
                        </ul>
                        <!-- 탄핵안 특별 요구사항 (탄핵안 선택 시 표시) -->
                        <ul id="impeachmentRequirementsList" style="display: none;">
                                <li class="impeachment-special">DAO 내 전체 구성원의 <strong>10%</strong> 또는 <strong>최소 30B</strong> 중 더 큰 값의 B-token이 모이면 투표 진입 (일반제안: 1%)</li>
                            <li>2주 내 투표 진입 실패시 제안 및 담보 소각</li>
                            <li class="impeachment-special">투표 시 정족수 <strong>60%</strong> 필요 (일반제안: 40%)</li>
                            <li class="impeachment-special">찬성 비율 <strong>60%</strong> 이상 필요 (일반제안: 50%)</li>
                            <li>투표 통과시 담보 반환, 실패시 담보 소각</li>
                        </ul>
                        </div>
                    </div>
                    
                    <!-- DAO생성제안 양식 -->
                    <div id="daoCreationProposalForm" class="proposal-form-section" style="display: none;">
                        <!-- 기본 정보 섹션 -->
                        <div class="dao-form-section">
                            <h4><i class="fas fa-info-circle"></i> 기본 정보</h4>
                            <div class="form-group">
                                <label for="daoTitle">DAO 이름</label>
                                <input type="text" id="daoTitle" placeholder="예: Innovation DAO" required>
                            </div>
                            <div class="form-group">
                                <label for="daoDescription">DAO 설명</label>
                                <textarea id="daoDescription" placeholder="DAO의 목적과 역할을 설명해주세요..." rows="3" required></textarea>
                            </div>
                        </div>

                        <!-- 참여 안내 섹션 -->
                        <div class="dao-form-section">
                            <h4><i class="fas fa-users"></i> 참여 안내</h4>
                            <div class="form-group">
                                <label for="daoParticipationGuide">참여하기 안내 내용</label>
                                <textarea id="daoParticipationGuide" placeholder="사용자가 '참여하기' 버튼을 눌렀을 때 보여질 안내 내용을 작성해주세요..." rows="4" required></textarea>
                            </div>
                        </div>

                        <!-- DCA 설정 섹션 -->
                        <div class="dao-form-section">
                            <h4><i class="fas fa-tasks"></i> 지정기여활동 (DCA) 설정</h4>
                            <div class="dca-setup-area">
                                <div class="dca-list" id="newDAODCAList">
                                    <!-- DCA 항목들이 동적으로 추가됩니다 -->
                                </div>
                                <button type="button" class="btn-secondary add-dca-btn" onclick="window.dapp.addNewDAODCA()">
                                    <i class="fas fa-plus"></i> DCA 추가
                                </button>
                            </div>
                        </div>

                        <!-- 기여하러가기 설정 섹션 -->
                        <div class="dao-form-section">
                            <h4><i class="fas fa-rocket"></i> 기여하러가기 설정</h4>
                            <div class="contribution-setup">
                                <div class="contribution-options-list" id="contributionOptionsList">
                                    <!-- 기여 옵션들이 동적으로 추가됩니다 -->
                                </div>
                                <button type="button" class="btn-secondary add-contribution-btn" onclick="window.dapp.addContributionOption()">
                                    <i class="fas fa-plus"></i> 기여하러가기 옵션 추가
                                </button>
                                <div class="form-help">
                                    <i class="fas fa-info-circle"></i>
                                    DevDAO처럼 여러 개의 기여하러가기 버튼을 설정할 수 있습니다. (예: GitHub 연동, 기여 가이드 등)
                                </div>
                            </div>
                        </div>

                        <!-- 이니셜 OP 설정 섹션 -->
                        <div class="dao-form-section">
                            <h4><i class="fas fa-crown"></i> 이니셜 OP 설정</h4>
                            <div class="form-group">
                                <label for="initialOPAddress">이니셜 OP 통신주소</label>
                                <input type="text" id="initialOPAddress" placeholder="OP가 될 사용자의 통신주소 (DID)를 입력하세요" required>
                                <small class="form-help">
                                    <i class="fas fa-info-circle"></i>
                                    이니셜 OP에게는 DAO 생성과 동시에 해당 DAO의 관리 권한이 부여됩니다.
                                </small>
                            </div>
                        </div>

                        <!-- 첨부파일 섹션 -->
                        <div class="dao-form-section">
                            <h4><i class="fas fa-paperclip"></i> 첨부파일</h4>
                            <div class="form-group">
                                <label for="daoAttachments">첨부파일</label>
                                <div class="file-upload-area" onclick="document.getElementById('daoFileInput').click()">
                                    <div class="file-upload-content">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                        <p>클릭하여 파일을 선택하거나 드래그하여 업로드하세요</p>
                                        <small>지원 형식: PDF, DOC, DOCX, TXT, JPG, PNG (최대 10MB)</small>
                                    </div>
                                    <input type="file" id="daoFileInput" multiple accept=".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png" style="display: none;" onchange="window.dapp.handleDAOFileUpload(this)">
                                </div>
                                <div class="uploaded-files-list" id="daoUploadedFiles"></div>
                            </div>
                        </div>

                        <!-- DAO생성제안 수수료 정보 -->
                        <div class="proposal-fee-info">
                            <div class="fee-notice">
                                <i class="fas fa-info-circle"></i>
                                <span>제안 수수료: <strong>0.05 B</strong> (DAO생성제안)</span>
                            </div>

                        </div>

                        <!-- DAO생성제안 요구사항 -->
                        <div class="proposal-requirements">
                            <h4>DAO생성제안 요구사항</h4>
                            <ul>
                                <li>전체 BROTHERHOOD 구성원의 <strong>5%</strong>만큼의 B-token이 모이면 투표 진입</li>
                                <li>1달 내 투표 진입 실패시 제안 및 담보 소각</li>
                                <li>투표 시 정족수 <strong>50%</strong> 필요</li>
                                <li>찬성 비율 <strong>60%</strong> 이상 필요</li>
                                <li>투표 통과시 담보 반환 및 DAO 생성, 실패시 담보 소각</li>
                            </ul>
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn-secondary" onclick="window.dapp.closeCreateProposalModal()">취소</button>
                        <button type="submit" class="btn-primary">제안 제출</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- DAO 컨소시엄 모달 -->
    <div id="daoConsortiumModal" class="modal">
        <div class="modal-content consortium-modal">
            <div class="modal-header">
                <h3 id="consortiumTitle"><i class="fas fa-building"></i> DAO 컨소시엄</h3>
                <button class="modal-close" onclick="window.dapp.closeConsortiumModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="consortium-container">
                    <!-- 컨소시엄 네비게이션 -->
                    <div class="consortium-nav">
                        <button class="consortium-tab active" data-consortium-tab="treasury">
                            <i class="fas fa-vault"></i> DAO 금고
                        </button>
                        <button class="consortium-tab" data-consortium-tab="announcements">
                            <i class="fas fa-bullhorn"></i> 공지
                        </button>
                        <button class="consortium-tab" data-consortium-tab="community">
                            <i class="fas fa-comments"></i> 커뮤니티
                        </button>
                    </div>

                    <!-- 컨소시엄 콘텐츠 -->
                    <div class="consortium-content">
                        <!-- DAO 금고 탭 -->
                        <div id="consortium-treasury" class="consortium-tab-content active">
                            <div class="treasury-overview">
                                <div class="treasury-card">
                                    <h4><i class="fas fa-vault"></i> 금고 현황</h4>
                                    <div class="treasury-balance">
                                        <div class="balance-item">
                                            <span class="balance-label">총 보유량</span>
                                            <span class="balance-value" id="treasuryBalance">0 B</span>
                                        </div>
                                        <div class="balance-item">
                                            <span class="balance-label">이번 달 수입</span>
                                            <span class="balance-value" id="treasuryIncome">0 B</span>
                                        </div>
                                    </div>
                                    <div class="treasury-actions">
                                        <button class="btn-support dao-sponsor-btn" onclick="window.dapp.showDAOSponsorModal()">
                                            <i class="fas fa-heart"></i> DAO 금고 후원하기
                                        </button>
                                    </div>
                                </div>
                                <div class="treasury-usage">
                                    <h4><i class="fas fa-chart-pie"></i> 사용 내역</h4>
                                    <div class="usage-list" id="treasuryUsage">
                                        <!-- 사용 내역이 동적으로 생성됩니다 -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 공지 탭 -->
                        <div id="consortium-announcements" class="consortium-tab-content">
                            <div class="announcements-section">
                                <div class="announcements-header">
                                    <h4><i class="fas fa-bullhorn"></i> DAO 공지사항</h4>
                                    <div class="announcements-header-actions">
                                        <div class="announcement-types">
                                            <span class="type-indicator rejected">거부된 제안</span>
                                            <span class="type-indicator final-approved">최종 승인</span>
                                            <span class="type-indicator final-rejected">최종 거부</span>
                                        </div>
                                        <div class="announcements-actions">
                                            <button class="op-announcement-btn protocol-overview-btn" onclick="window.dapp.showCreateAnnouncementModal()" style="display: none;">
                                                <i class="fas fa-plus"></i>
                                                공지 작성
                                            </button>
                                            
                                </div>
                                    </div>
                                </div>
                                <div class="dao-announcements" id="daoAnnouncements">
                                    <!-- DAO 공지사항들이 동적으로 생성됩니다 -->
                                </div>
                            </div>
                        </div>



                        <!-- 커뮤니티 탭 -->
                        <div id="consortium-community" class="consortium-tab-content">
                            <div class="community-section">
                                <div class="community-header">
                                    <h4><i class="fas fa-comments"></i> 커뮤니티</h4>
                                    <div class="community-actions">
                                        <button class="btn-secondary community-filter-btn" onclick="window.dapp.toggleMyPosts()" id="myPostsBtn">
                                            <i class="fas fa-user-edit"></i> 나의 글
                                        </button>
                                    <button class="btn-primary" onclick="window.dapp.createCommunityPost()">
                                        <i class="fas fa-plus"></i> 글 작성
                                    </button>
                                    </div>
                                </div>
                                <div class="community-posts" id="communityPosts">
                                    <!-- 커뮤니티 게시글들이 동적으로 생성됩니다 -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 프로필 사진 업로드 모달 -->
    <div id="profilePhotoModal" class="modal">
        <div class="modal-content profile-photo-modal">
            <div class="modal-header">
                <h3><i class="fas fa-camera"></i> 프로필 사진 설정</h3>
                <button class="modal-close" onclick="window.dapp.closeProfilePhotoModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="profile-photo-upload">
                    <div class="current-photo-preview">
                        <div class="photo-preview" id="photoPreview">
                            <i class="fas fa-user"></i>
                        </div>
                    </div>
                    
                    <div class="upload-options">
                        <input type="file" id="photoInput" accept="image/*" style="display: none;" onchange="window.dapp.handlePhotoSelect(event)">
                        
                        <button class="btn-primary upload-btn" onclick="document.getElementById('photoInput').click()">
                            <i class="fas fa-upload"></i> 사진 업로드
                        </button>
                        
                        <button class="btn-secondary reset-btn" onclick="window.dapp.resetProfilePhoto()">
                            <i class="fas fa-undo"></i> 기본 아바타로 리셋
                        </button>
                    </div>
                    
                    <div class="photo-requirements">
                        <h4>사진 요구사항</h4>
                        <ul>
                            <li>최대 파일 크기: 5MB</li>
                            <li>지원 형식: JPG, PNG, GIF</li>
                            <li>권장 크기: 500x500px 이상</li>
                            <li>정사각형 비율 권장</li>
                        </ul>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="window.dapp.closeProfilePhotoModal()">취소</button>
                    <button type="button" class="btn-primary" onclick="window.dapp.saveProfilePhoto()" id="savePhotoBtn" disabled>저장</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 공개 채팅방 생성 모달 -->
    <div id="createPublicChatModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-globe"></i> 공개 채팅방 만들기</h3>
                <button class="modal-close" onclick="window.dapp.closeCreatePublicChatModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="createPublicChatForm" onsubmit="window.dapp.handleCreatePublicChat(event)">
                    <div class="form-group">
                        <label for="publicChatName">채팅방 이름</label>
                        <input type="text" id="publicChatName" name="name" required 
                               placeholder="채팅방 이름을 입력하세요" maxlength="50">
                    </div>
                    

                    
                    <div class="form-group">
                        <label for="publicChatDescription">설명</label>
                        <textarea id="publicChatDescription" name="description" rows="4" 
                                  placeholder="채팅방 설명을 입력하세요 (선택사항)" maxlength="200"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="publicChatMaxMembers">최대 인원</label>
                        <input type="number" id="publicChatMaxMembers" name="maxMembers" 
                               min="10" max="1000" value="100" required>
                        <small>10명 ~ 1000명까지 설정 가능</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="publicChatTags">태그</label>
                        <input type="text" id="publicChatTags" name="tags" 
                               placeholder="#BROTHERHOOD #개발 #커뮤니티 (쉼표로 구분)">
                        <small>검색에 도움이 되는 태그를 추가하세요</small>
                    </div>
                    
                    <div class="public-chat-fee-info">
                        <div class="fee-notice">
                            <i class="fas fa-info-circle"></i>
                            <span>채팅방 생성 수수료: <strong>0.01 B</strong></span>
                        </div>
                        <div class="fee-breakdown">
                            <small>네트워크 유지비용으로 사용됩니다</small>
                        </div>
                    </div>
                    
                    <div class="modal-actions">
                        <button type="button" class="btn-secondary" onclick="window.dapp.closeCreatePublicChatModal()">취소</button>
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-plus"></i>
                            채팅방 만들기
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- OP 공지 작성 모달 -->
    <div id="createAnnouncementModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-bullhorn"></i> 공지사항 작성</h3>
                <button class="modal-close" onclick="window.dapp.closeCreateAnnouncementModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="createAnnouncementForm" onsubmit="window.dapp.handleCreateAnnouncement(event)">
                    <div class="form-group">
                        <label for="announcementTitle">제목</label>
                        <input type="text" id="announcementTitle" name="title" required 
                               placeholder="공지사항 제목을 입력하세요">
                    </div>
                    
                    <div class="form-group">
                        <label for="announcementType">공지 유형</label>
                        <select id="announcementType" name="type" required>
                            <option value="">유형을 선택하세요</option>
                            <option value="general">일반 공지</option>
                            <option value="important">중요 공지</option>
                            <option value="event">이벤트 공지</option>
                            <option value="maintenance">점검 공지</option>
                            <option value="policy">정책 변경</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="announcementContent">내용</label>
                        <textarea id="announcementContent" name="content" required rows="6" 
                                  placeholder="공지사항 내용을 작성하세요"></textarea>
                    </div>
                    
                    <div class="posting-fee-info">
                        <div class="fee-notice">
                            <i class="fas fa-info-circle"></i>
                            <span>공지 수수료: <strong>0.001 B</strong></span>
                        </div>
                        <div class="fee-breakdown">
                            <small>블록체인 기록 및 네트워크 전파 비용입니다</small>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="announcementPinned" name="pinned">
                            상단 고정
                        </label>
                    </div>
                    
                    <div class="modal-actions">
                        <button type="button" class="btn-secondary" onclick="window.dapp.closeCreateAnnouncementModal()">취소</button>
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-bullhorn"></i>
                            공지 게시
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 환경 설정 -->
    <script src="config.js"></script>
    
    <!-- 메인 애플리케이션 -->
    <script src="app.js"></script>
    <script>
        // 프로필 사진 관리 스크립트
        
        // DApp 로드 완료 후 프로필 사진 메서드 추가
        document.addEventListener('DOMContentLoaded', function() {
            
            // DApp에 프로필 사진 메서드 추가
            if (typeof window.dapp !== 'undefined') {
                
                // 프로필 사진 모달 열기
                window.dapp.openProfilePhotoModal = function() {
                    const modal = document.getElementById('profilePhotoModal');
                    const photoPreview = document.getElementById('photoPreview');
                    const saveBtn = document.getElementById('savePhotoBtn');
                    
                    // 현재 프로필 사진 로드
                    this.loadCurrentPhoto(photoPreview);
                    
                    // 저장 버튼 비활성화
                    saveBtn.disabled = true;
                    
                    modal.classList.add('active');
                };

                // 프로필 사진 모달 닫기
                window.dapp.closeProfilePhotoModal = function() {
                    const modal = document.getElementById('profilePhotoModal');
                    modal.classList.remove('active');
                    
                    // 선택된 사진 초기화
                    this.selectedPhoto = null;
                    const photoInput = document.getElementById('photoInput');
                    if (photoInput) photoInput.value = '';
                };

                // 현재 프로필 사진 로드
                window.dapp.loadCurrentPhoto = function(previewElement) {
                    if (this.currentUser && this.currentUser.profilePhoto) {
                        previewElement.innerHTML = '<img src="' + this.currentUser.profilePhoto + '" alt="프로필 사진">';
                    } else {
                        // 기본 아바타 표시
                        const userName = this.currentUser?.name || '미설정';
                        if (userName !== '미설정') {
                            previewElement.innerHTML = '';
                            previewElement.textContent = userName.charAt(0).toUpperCase();
                        } else {
                            previewElement.innerHTML = '<i class="fas fa-user"></i>';
                        }
                    }
                };

                // 사진 선택 처리
                window.dapp.handlePhotoSelect = function(event) {
                    const file = event.target.files[0];
                    if (!file) return;

                    // 파일 크기 검증 (5MB)
                    if (file.size > 5 * 1024 * 1024) {
                        this.showErrorMessage('파일 크기는 5MB를 초과할 수 없습니다.');
                        return;
                    }

                    // 파일 형식 검증
                    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];
                    if (!allowedTypes.includes(file.type)) {
                        this.showErrorMessage('JPG, PNG, GIF 형식만 지원됩니다.');
                        return;
                    }

                    // 파일 읽기
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        this.selectedPhoto = e.target.result;
                        
                        // 미리보기 업데이트
                        const photoPreview = document.getElementById('photoPreview');
                        photoPreview.innerHTML = '<img src="' + this.selectedPhoto + '" alt="선택된 사진">';
                        
                        // 저장 버튼 활성화
                        const saveBtn = document.getElementById('savePhotoBtn');
                        if (saveBtn) saveBtn.disabled = false;
                    };
                    reader.readAsDataURL(file);
                };

                // 프로필 사진 리셋
                window.dapp.resetProfilePhoto = function() {
                    const photoPreview = document.getElementById('photoPreview');
                    
                    // 기본 아바타로 리셋
                    if (this.currentUser && this.currentUser.name && this.currentUser.name !== '미설정') {
                        photoPreview.innerHTML = '';
                        photoPreview.textContent = this.currentUser.name.charAt(0).toUpperCase();
                    } else {
                        photoPreview.innerHTML = '<i class="fas fa-user"></i>';
                    }
                    
                    this.selectedPhoto = 'reset';
                    const saveBtn = document.getElementById('savePhotoBtn');
                    if (saveBtn) saveBtn.disabled = false;
                };

                // 프로필 사진 저장
                window.dapp.saveProfilePhoto = function() {
                    try {
                        if (!this.currentUser) {
                            this.showErrorMessage('로그인이 필요합니다.');
                            return;
                        }

                        // 프로필 사진 데이터 업데이트
                        if (this.selectedPhoto === 'reset') {
                            this.currentUser.profilePhoto = null;
                        } else if (this.selectedPhoto) {
                            this.currentUser.profilePhoto = this.selectedPhoto;
                        }

                        // 로컬 스토리지에 저장
                        localStorage.setItem('baekya_auth', JSON.stringify(this.currentUser));

                        // UI 업데이트
                        this.updateProfilePhotoInUI();

                        // 성공 메시지
                        this.showSuccessMessage('프로필 사진이 업데이트되었습니다.');

                        // 모달 닫기
                        this.closeProfilePhotoModal();

                    } catch (error) {
                        console.error('프로필 사진 저장 실패:', error);
                        this.showErrorMessage('프로필 사진 저장에 실패했습니다.');
                    }
                };

                // UI에서 프로필 사진 업데이트
                window.dapp.updateProfilePhotoInUI = function() {
                    const profilePhoto = document.getElementById('profilePhoto');
                    const mobileAvatar = document.getElementById('mobile-profile-avatar');

                    if (this.currentUser && this.currentUser.profilePhoto) {
                        // 프로필 사진이 있는 경우
                        if (profilePhoto) {
                            profilePhoto.innerHTML = '<img src="' + this.currentUser.profilePhoto + '" alt="프로필 사진">';
                        }
                        if (mobileAvatar) {
                            mobileAvatar.innerHTML = '<img src="' + this.currentUser.profilePhoto + '" alt="프로필 사진">';
                        }
                    } else {
                        // 기본 아바타 표시
                        const userName = this.currentUser?.name || '미설정';
                        const displayText = userName !== '미설정' ? userName.charAt(0).toUpperCase() : 'U';
                        
                        if (profilePhoto) {
                            if (userName !== '미설정') {
                                profilePhoto.innerHTML = '';
                                profilePhoto.textContent = displayText;
                            } else {
                                profilePhoto.innerHTML = '<i class="fas fa-user"></i>';
                            }
                        }
                        if (mobileAvatar) {
                            mobileAvatar.textContent = displayText;
                        }
                    }
                };

                // 에러 메시지 표시 (기존에 없는 경우에만)
                if (!window.dapp.showErrorMessage) {
                    window.dapp.showErrorMessage = function(message) {
                        // 기존 toast가 있다면 제거
                        const existingToast = document.querySelector('.toast.error');
                        if (existingToast) {
                            existingToast.remove();
                        }

                        const toast = document.createElement('div');
                        toast.className = 'toast error';
                        toast.innerHTML = '<i class="fas fa-exclamation-circle"></i><span>' + message + '</span>';
                        
                        // 에러 스타일 추가
                        toast.style.borderLeftColor = '#ef4444';
                        
                        document.body.appendChild(toast);
                        
                        setTimeout(function() { toast.classList.add('show'); }, 100);
                        setTimeout(function() {
                            toast.classList.remove('show');
                            setTimeout(function() {
                                if (document.body.contains(toast)) {
                                    document.body.removeChild(toast);
                                }
                            }, 300);
                        }, 3000);
                    };
                }

                // 기존 updateUserProfile 메서드 확장
                const originalUpdateUserProfile = window.dapp.updateUserProfile.bind(window.dapp);
                window.dapp.updateUserProfile = function() {
                    // 기존 프로필 업데이트 실행
                    originalUpdateUserProfile();
                    
                    // 프로필 사진 UI 업데이트
                    this.updateProfilePhotoInUI();
                    
                    // 토큰 액션 버튼 업데이트
                    this.updateTokenActionButtons();
                };

                // 기존 updateMobileProfileHeader 메서드 확장
                const originalUpdateMobileProfileHeader = window.dapp.updateMobileProfileHeader.bind(window.dapp);
                window.dapp.updateMobileProfileHeader = function() {
                    // 기존 모바일 헤더 업데이트 실행
                    originalUpdateMobileProfileHeader();
                    
                    // 프로필 사진이 있으면 적용
                    const mobileAvatar = document.getElementById('mobile-profile-avatar');
                    if (mobileAvatar && this.currentUser && this.currentUser.profilePhoto) {
                        mobileAvatar.innerHTML = '<img src="' + this.currentUser.profilePhoto + '" alt="프로필 사진">';
                    }
                };

                // 클립보드 복사 기능 추가
                window.dapp.copyToClipboard = function(elementId, addressType) {
                    const element = document.getElementById(elementId);
                    if (!element) return;
                    
                    const text = element.textContent.trim();
                    
                    // 복사할 내용이 없거나 기본값인 경우
                    if (!text || text === '연결되지 않음' || text === '미할당') {
                        this.showErrorMessage(addressType + '가 설정되지 않았습니다.');
                        return;
                    }
                    
                    // 클립보드에 복사
                    if (navigator.clipboard && window.isSecureContext) {
                        // 최신 브라우저의 Clipboard API 사용
                        navigator.clipboard.writeText(text).then(() => {
                            this.showCopySuccess(addressType);
                            this.animateCopyButton(elementId);
                        }).catch(err => {
                            this.fallbackCopyTextToClipboard(text, addressType);
                        });
                    } else {
                        // 폴백 방법 사용
                        this.fallbackCopyTextToClipboard(text, addressType);
                    }
                };

                // 폴백 복사 방법
                window.dapp.fallbackCopyTextToClipboard = function(text, addressType) {
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    textArea.style.top = '0';
                    textArea.style.left = '0';
                    textArea.style.position = 'fixed';
                    textArea.style.opacity = '0';
                    
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    
                    try {
                        const successful = document.execCommand('copy');
                        if (successful) {
                            this.showCopySuccess(addressType);
                            this.animateCopyButton(elementId);
                        } else {
                            this.showErrorMessage('복사에 실패했습니다.');
                        }
                    } catch (err) {
                        this.showErrorMessage('복사 기능을 지원하지 않는 브라우저입니다.');
                    }
                    
                    document.body.removeChild(textArea);
                };

                // 복사 성공 메시지
                window.dapp.showCopySuccess = function(addressType) {
                    const toast = document.createElement('div');
                    toast.className = 'toast success';
                    toast.innerHTML = '<i class="fas fa-check-circle"></i><span>' + addressType + '가 클립보드에 복사되었습니다.</span>';
                    
                    document.body.appendChild(toast);
                    
                    setTimeout(function() { toast.classList.add('show'); }, 100);
                    setTimeout(function() {
                        toast.classList.remove('show');
                        setTimeout(function() {
                            if (document.body.contains(toast)) {
                                document.body.removeChild(toast);
                            }
                        }, 300);
                    }, 2000);
                };

                // 복사 버튼 애니메이션
                window.dapp.animateCopyButton = function(elementId) {
                    // 해당 주소와 연관된 복사 버튼 찾기
                    const element = document.getElementById(elementId);
                    if (!element) return;
                    
                    const container = element.closest('.address-container');
                    if (!container) return;
                    
                    const copyBtn = container.querySelector('.copy-btn');
                    if (!copyBtn) return;
                    
                    // 복사 완료 상태로 변경
                    copyBtn.classList.add('copied');
                    const icon = copyBtn.querySelector('i');
                    const originalClass = icon.className;
                    icon.className = 'fas fa-check';
                    
                    // 2초 후 원래 상태로 복원
                    setTimeout(function() {
                        copyBtn.classList.remove('copied');
                        icon.className = originalClass;
                    }, 2000);
                };

                // 토큰 전송 페이지로 이동
                window.dapp.goToTokenTransfer = function() {
                    // 지갑 탭으로 전환
                    const walletTab = document.querySelector('[data-tab="wallet"]');
                    if (walletTab) {
                        walletTab.click();
                    }
                    
                    // 잠시 후 토큰 전송 카드로 스크롤
                    setTimeout(function() {
                        const transactionCard = document.querySelector('.transaction-card');
                        if (transactionCard) {
                            transactionCard.scrollIntoView({ 
                                behavior: 'smooth',
                                block: 'center'
                            });
                            
                            // 토큰 전송 카드를 강조하는 애니메이션
                            transactionCard.classList.add('highlight-animation');
                            setTimeout(function() {
                                transactionCard.classList.remove('highlight-animation');
                            }, 2000);
                        }
                    }, 300);
                };



                // 토큰 액션 버튼 표시 업데이트
                window.dapp.updateTokenActionButtons = function() {
                    const bTokenTransferButton = document.getElementById('bTokenTransferButton');
                    
                    if (this.isAuthenticated && this.currentUser) {
                        if (bTokenTransferButton) {
                            bTokenTransferButton.style.display = 'inline-flex';
                        }
                    } else {
                        if (bTokenTransferButton) {
                            bTokenTransferButton.style.display = 'none';
                        }
                    }
                };

                // 주소 카드 토글 기능 (P토큰 토글과 동일)
                window.dapp.toggleAddressCard = function() {
                    const cardContent = document.getElementById('addressCardContent');
                    const toggleIcon = document.getElementById('addressToggleIcon');
                    
                    if (cardContent.style.display === 'none') {
                        // 카드 열기
                        cardContent.style.display = 'block';
                        cardContent.classList.remove('hiding');
                        cardContent.classList.add('showing');
                        toggleIcon.classList.remove('fa-chevron-down');
                        toggleIcon.classList.add('fa-chevron-up');
                        toggleIcon.classList.add('rotated');
                    } else {
                        // 카드 닫기
                        cardContent.classList.remove('showing');
                        cardContent.classList.add('hiding');
                        toggleIcon.classList.remove('fa-chevron-up');
                        toggleIcon.classList.add('fa-chevron-down');
                        toggleIcon.classList.remove('rotated');
                        
                        // 애니메이션 완료 후 숨김
                        setTimeout(function() {
                            cardContent.style.display = 'none';
                            cardContent.classList.remove('hiding');
                        }, 300);
                    }
                };

                console.log('📸 프로필 사진 기능이 로드되었습니다.');

                // 초기 로드 시 토큰 버튼 상태 확인
                setTimeout(function() {
                    if (window.dapp && window.dapp.updateTokenActionButtons) {
                        window.dapp.updateTokenActionButtons();
                    }
                }, 500);

                // 탭 변경 시 토큰 버튼 업데이트를 위한 이벤트 리스너 추가
                const tabButtons = document.querySelectorAll('[data-tab]');
                tabButtons.forEach(function(tabBtn) {
                    tabBtn.addEventListener('click', function() {
                        // 탭 변경 후 잠시 기다린 다음 토큰 버튼 업데이트
                        setTimeout(function() {
                            if (window.dapp && window.dapp.updateTokenActionButtons) {
                                window.dapp.updateTokenActionButtons();
                            }
                        }, 100);
                    });
                });
            }
        });
    </script>

    <!-- 프로필 사진 보기 모달 -->
    <div id="profileViewModal" class="profile-view-modal">
        <div class="profile-view-content">
            <div class="profile-view-header">
                <h3>연락처 정보</h3>
                <button class="profile-close-btn" onclick="window.dapp.closeProfileView()">&times;</button>
            </div>
            <div class="profile-view-body">
                <img id="profileViewImage" class="profile-view-image" src="" alt="프로필 사진">
                <div class="profile-view-info">
                    <div class="profile-view-name" id="profileViewName"></div>
                    <!-- 온라인 상태 표시 제거됨 -->
                    <div class="profile-view-address">
                        <label>통신 주소</label>
                        <div class="profile-address-container">
                            <span id="profileViewAddress" class="profile-address"></span>
                            <button class="profile-copy-btn" onclick="window.dapp.copyProfileAddress()" title="주소 복사">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                    <div class="profile-view-address" id="profileViewUsernameContainer" style="display: none;">
                        <label>아이디</label>
                        <div class="profile-address-container">
                            <span id="profileViewUsername" class="profile-address"></span>
                            <button class="profile-copy-btn" onclick="window.dapp.copyProfileUsername()" title="아이디 복사">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- 연락처 액션 버튼들 -->
                    <div class="profile-actions">
                        <button class="profile-action-btn phone-btn" id="profilePhoneBtn" title="음성통화">
                            <i class="fas fa-phone"></i>
                            <span>통화</span>
                        </button>
                        <button class="profile-action-btn video-btn" id="profileVideoBtn" title="영상통화">
                            <i class="fas fa-video"></i>
                            <span>영상</span>
                        </button>
                        <button class="profile-action-btn chat-btn" id="profileChatBtn" title="채팅하기">
                            <i class="fas fa-comment"></i>
                            <span>채팅</span>
                        </button>
                    </div>
                    
                    <!-- 연락처 관리 버튼들 -->
                    <div class="profile-management-actions">
                        <button class="profile-management-btn block-btn" id="profileBlockBtn" title="사용자 차단">
                            <i class="fas fa-ban"></i>
                            <span>차단</span>
                        </button>
                        <button class="profile-management-btn delete-btn" id="profileDeleteBtn" title="연락처 삭제">
                            <i class="fas fa-trash"></i>
                            <span>삭제</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- QR 코드 라이브러리 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
    
    
    
    <script src="device-uuid.js"></script>
    <script src="account-management.js"></script>
    <script src="apk-download-banner.js"></script>
    <script src="app.js"></script>
    <script src="ime-fix.js"></script>
    
    <!-- 서비스 워커 등록 -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('서비스 워커가 등록되었습니다:', registration);
                    })
                    .catch(error => {
                        console.log('서비스 워커 등록 실패:', error);
                    });
            });
        }
    </script>

    <!-- 프로필 설정 모달 -->
    <div id="profileSettingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-cog"></i> 프로필 설정</h3>
                <button class="modal-close" onclick="window.dapp.closeProfileSettingsModal()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- 프로필 사진 설정 섹션 -->
                <div class="profile-photo-upload">
                    <h4><i class="fas fa-camera"></i> 프로필 사진</h4>
                    <div class="current-photo-preview">
                        <div class="photo-preview" id="photoPreview">
                            <i class="fas fa-user"></i>
                        </div>
                    </div>
                    <div class="upload-options">
                        <input type="file" id="photoInput" accept="image/*" onchange="window.dapp.handlePhotoSelect(event)" style="display: none;">
                        <button class="upload-btn" onclick="document.getElementById('photoInput').click()">
                            <i class="fas fa-upload"></i> 사진 업로드
                        </button>
                        <button class="reset-btn" onclick="window.dapp.resetProfilePhoto()">
                            <i class="fas fa-user"></i> 기본 아바타
                        </button>
                    </div>
                    <div class="photo-requirements">
                        <h4>사진 요구사항</h4>
                        <ul>
                            <li>최대 파일 크기: 5MB</li>
                            <li>지원 형식: JPG, PNG, GIF</li>
                            <li>권장 크기: 200x200 픽셀</li>
                        </ul>
                    </div>
                </div>



                <!-- 보안 설정 섹션 -->
                <div class="security-settings-section" style="margin-top: 30px; border-top: 1px solid var(--border-color); padding-top: 20px;">
                    <h4><i class="fas fa-shield-alt"></i> 보안 설정</h4>
                    <div class="security-actions">

                        <button class="btn-secondary security-btn" onclick="window.dapp.resetPassword()">
                            <i class="fas fa-key"></i> 비밀번호 재설정
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn-secondary" onclick="window.dapp.closeProfileSettingsModal()">취소</button>
                <button type="button" class="btn-primary" id="saveProfileBtn" onclick="window.dapp.saveProfileSettings()">
                    <i class="fas fa-save"></i> 저장
                </button>
            </div>
        </div>
    </div>

                <!-- BROTHERHOOD 네트워크 친구 검색 모달 -->
    <div id="friendSearchModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-search"></i> BROTHERHOOD 네트워크 친구 검색</h3>
                <button class="modal-close" onclick="window.dapp.closeFriendSearchModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="network-search-section">
                    <p class="search-description">
                        <i class="fas fa-network-wired"></i>
                        BROTHERHOOD 네트워크에 등록된 사용자의 통신주소 또는 아이디를 검색하여 친구로 추가할 수 있습니다.
                    </p>
                    
                    <div class="search-input-section">
                        <div class="modern-search-wrapper">
                            <div class="search-input-container">
                                <i class="fas fa-search search-icon"></i>
                                <input type="text" id="networkSearchInput" class="modern-search-input" placeholder="통신주소 또는 아이디를 입력하세요..." onkeypress="if(event.key==='Enter') window.dapp.searchNetworkUsers()">
                                <button class="modern-search-btn" onclick="window.dapp.searchNetworkUsers()" title="검색">
                            <i class="fas fa-search"></i>
                                    <span>검색</span>
                            </button>
                            </div>
                        </div>
                        <div class="search-tips">
                            <small><i class="fas fa-info-circle"></i> 예: 010-1234-5678 또는 user1234</small>
                        </div>
                    </div>
                </div>

                <div class="search-status" id="searchStatus" style="display: none;">
                    <div class="searching-indicator">
                        <i class="fas fa-spinner fa-spin"></i>
                        <span>BROTHERHOOD 네트워크에서 검색 중...</span>
                    </div>
                </div>

                <div class="search-results-section" id="searchResultsSection" style="display: none;">
                    <h4><i class="fas fa-users"></i> 검색 결과</h4>
                    <div class="network-users-list" id="networkUsersList">
                        <!-- 검색 결과가 동적으로 생성됩니다 -->
                    </div>
                </div>

                <div class="no-results" id="noResults" style="display: none;">
                    <i class="fas fa-user-slash"></i>
                    <h4>검색 결과가 없습니다</h4>
                    <p>입력하신 통신주소나 닉네임에 해당하는 사용자를 찾을 수 없습니다.</p>
                    <small>정확한 주소를 입력했는지 확인해보세요.</small>
                </div>
            </div>
        </div>
    </div>

    <!-- 사용자 프로필 정보 모달 -->
    <div id="userProfileModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user"></i> 사용자 정보</h3>
                <button class="modal-close" onclick="window.dapp.closeUserProfileModal()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- 사용자 프로필 정보 -->
                <div class="user-profile-info">
                    <div class="user-profile-header">
                        <div class="user-avatar-large" id="userProfileAvatar">U</div>
                                             <div class="user-basic-info">
                         <div class="user-profile-name" id="userProfileName">사용자</div>
                     </div>
                    </div>
                    

                </div>

                <!-- 사용자 생성 제안 목록 -->
                <div class="user-proposals-section">
                    <h4><i class="fas fa-lightbulb"></i> 생성한 제안</h4>
                    <div class="user-proposals-list" id="userProposalsList">
                        <!-- 사용자가 생성한 제안들이 표시됩니다 -->
                    </div>
                </div>
            </div>
        </div>
    </div>



    <!-- 제안하기 모달 -->

    <!-- QR 코드 라이브러리 -->
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
    <script src="qr-manager.js"></script>
</body>
</html> 